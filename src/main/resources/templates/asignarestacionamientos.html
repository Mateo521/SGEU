<!-- Fragmento Thymeleaf -->
<div th:fragment="contenido">
  <style>
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    .table-row-hover {
      transition: all 0.2s ease;
    }

    .table-row-hover:hover {
      background: linear-gradient(90deg, rgba(99, 102, 241, 0.03) 0%, rgba(139, 92, 246, 0.03) 100%);
      transform: scale(1.005);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .modal-backdrop {
      backdrop-filter: blur(8px);
      animation: fadeIn 0.2s ease-out;
    }

    .modal-content {
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status-badge {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.8;
      }
    }
  </style>

  <!-- Barra superior: búsqueda + filtros + botón -->
  <div class="mb-6 bg-white rounded-xl shadow-lg p-6 fade-in">
    <div class="flex flex-col md:flex-row gap-4 items-stretch md:items-end justify-between">
      <div class="flex-1 flex flex-col md:flex-row gap-3">
        <div class="relative flex-1">
          <label class="block text-sm font-semibold text-slate-700 mb-2">
            <svg class="w-4 h-4 inline mr-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Guardia
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <input id="ae-searchGuard" type="text" placeholder="Buscar por guardia..."
              class="w-full pl-11 pr-4 py-2.5 bg-slate-50 border-2 border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder:text-slate-400" />
          </div>
        </div>

        <div class="flex-1">
          <label class="block text-sm font-semibold text-slate-700 mb-2">
            <svg class="w-4 h-4 inline mr-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            Estacionamiento
          </label>
          <select id="ae-filterParking"
            class="w-full px-4 py-2.5 bg-slate-50 border-2 border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
          </select>
        </div>

        <div class="flex-1">
          <label class="block text-sm font-semibold text-slate-700 mb-2">
            <svg class="w-4 h-4 inline mr-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Turno
          </label>
          <select id="ae-filterShift"
            class="w-full px-4 py-2.5 bg-slate-50 border-2 border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
            <option value="all">Todos los turnos</option>
            <option value="08:00 - 14:00">Mañana (08:00 - 14:00)</option>
            <option value="14:00 - 21:00">Tarde (14:00 - 21:00)</option>
          </select>
        </div>
      </div>

      <div class="flex items-end">
        <button id="ae-openModal"
          class="w-full md:w-auto bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 transform transition-all duration-200 hover:scale-105 shadow-lg flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Nueva Asignación
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="bg-white rounded-xl shadow-lg overflow-hidden fade-in">
    <div class="overflow-hidden">
      <table class="w-full" id="ae-table">
        <thead class="bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Guardia</th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">
              Estacionamiento</th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Turno</th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Fecha</th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Estado</th>
            <th class="px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100" id="ae-tbody"><!-- filas JS --></tbody>
      </table>
    </div>

    <div
      class="flex flex-col sm:flex-row items-center justify-between px-6 py-4 bg-slate-50 border-t border-slate-200 gap-3">
      <div class="flex items-center gap-2 text-slate-600 text-sm">
        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        Total de guardias: <span class="font-bold text-slate-900" id="ae-total">0</span>
      </div>
      <div class="flex items-center gap-2 text-slate-500 text-xs">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Última actualización: <span id="ae-lastUpdate" class="font-medium"></span>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="ae-modal" class="modal-backdrop fixed inset-0 hidden z-50 items-center justify-center bg-black/50 p-4">
    <div class="modal-content w-full max-w-lg rounded-2xl bg-white shadow-2xl">
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200">
        <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2" id="ae-modalTitle">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Nueva asignación
        </h3>
        <button id="ae-closeModal"
          class="text-slate-400 hover:text-slate-600 transition-colors p-2 hover:bg-slate-100 rounded-lg">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="px-6 py-5 space-y-4">
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            Guardia
          </label>
          <select id="ae-modalGuard"
            class="w-full px-4 py-2.5 bg-slate-50 border-2 border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
            <option value="">Seleccionar guardia...</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            Estacionamiento
          </label>
          <select id="ae-modalParking"
            class="w-full px-4 py-2.5 bg-slate-50 border-2 border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
            <option value="">Seleccionar estacionamiento...</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Turno
          </label>
          <select id="ae-modalShift"
            class="w-full px-4 py-2.5 bg-slate-50 border-2 border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
            <option value="">Seleccionar turno...</option>
            <option value="08:00 - 14:00">Mañana (08:00 - 14:00)</option>
            <option value="14:00 - 21:00">Tarde (14:00 - 21:00)</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Fecha
          </label>
          <input id="ae-modalDate" type="text" readonly
            class="w-full px-4 py-2.5 bg-slate-100 border-2 border-slate-200 text-slate-600 text-sm rounded-lg cursor-not-allowed">
        </div>

        <div class="pt-2 flex flex-col sm:flex-row justify-end gap-3">
          <button id="ae-cancel" type="button"
            class="px-6 py-2.5 rounded-lg bg-slate-100 text-slate-700 text-sm font-semibold hover:bg-slate-200 transition-all duration-200 hover:scale-105">
            Cancelar
          </button>
          <button id="ae-save" type="button"
            class="px-6 py-2.5 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 text-white text-sm font-semibold hover:from-blue-700 hover:to-blue-800 transition-all duration-200 hover:scale-105 shadow-lg">
            Guardar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS (sin dependencias, idéntica lógica a tu demo, con colores adaptados) -->
  <script>
    (function () {
      // === Endpoints
      const API_TURNOS = '/api/turnos';
      const API_EMPLEADOS = '/api/empleados';
      const API_EMPLEADOS_GUARDIAS = '/api/empleados/guardias';
      const API_EST = '/api/estacionamientos';

      // === Helpers
      const $ = (id) => document.getElementById(id);
      let turnos = [], empleados = [], estacionamientos = [];
      let editingId = null;
      let page = 0, size = 50;

      async function fetchJSON(url, opts) {
        const res = await fetch(url, opts);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.headers.get('content-type')?.includes('application/json') ? res.json() : null;
      }
      function today() { return new Date().toISOString().slice(0, 10); }
      function nowTime() { return new Date().toLocaleTimeString('es-AR'); }
      function statusFor(hIn, hOut) {
        const [a] = hIn.split(':'), [b] = hOut.split(':'), h = new Date().getHours();
        if (h >= +a && h < +b) return { t: 'Activo', cls: 'bg-green-100 text-green-700 border-green-200' };
        if (h < +a) return { t: 'Próximo', cls: 'bg-blue-100 text-blue-700 border-blue-200' };
        return { t: 'Finalizado', cls: 'bg-slate-100 text-slate-700 border-slate-200' };
      }
      function shiftFrom(hIn, hOut) { return `${hIn} - ${hOut}`; }
      function splitShift(s) { const m = s.match(/(\d{2}:\d{2}).+(\d{2}:\d{2})/); return m ? { in: m[1], out: m[2] } : { in: '08:00', out: '14:00' }; }

      // === Render
      function render(list = turnos) {
        const tbody = $('ae-tbody');
        if (!list.length) {
          tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-16 text-center">
            <div class="flex flex-col items-center gap-3">
              <svg class="w-16 h-16 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
              </svg>
              <div class="text-lg font-semibold text-slate-600">No hay asignaciones</div>
              <p class="text-sm text-slate-400">Presiona "Nueva Asignación" para comenzar</p>
            </div>
          </td></tr>`;
        } else {
          tbody.innerHTML = list.map(t => {
            const st = statusFor(t.horaIngreso, t.horaSalida);
            const initials = (t.empleadoNombre || '').split(' ').map(n => n[0] || '').join('').slice(0, 2).toUpperCase();
            return `
            <tr class="table-row-hover">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-sm font-bold shadow-md">
                    ${initials || 'G'}
                  </div>
                  <span class="text-slate-900 font-semibold">${t.empleadoNombre || '-'}</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-50 border border-purple-200 text-purple-700 text-sm font-medium">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                  </svg>
                  ${t.estacionamientoNombre || '-'}
                </span>
              </td>
              <td class="px-6 py-4">
                <span class="text-slate-700 font-medium flex items-center gap-1.5">
                  <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  ${shiftFrom(t.horaIngreso, t.horaSalida)}
                </span>
              </td>
              <td class="px-6 py-4">
                <span class="text-slate-600 font-medium">${t.fechaInicio}</span>
              </td>
              <td class="px-6 py-4">
                <span class="status-badge px-3 py-1.5 rounded-full text-xs font-bold border-2 ${st.cls}">
                  ${st.t}
                </span>
              </td>
              <td class="px-6 py-4">
                <div class="flex justify-end gap-2">
                  <button data-edit="${t.id}" title="Editar" class="p-2 rounded-lg border-2 border-slate-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                  </button>
                  <button data-del="${t.id}" title="Eliminar" class="p-2 rounded-lg border-2 border-slate-200 text-red-600 hover:bg-red-50 hover:border-red-300 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                  </button>
                </div>
              </td>
            </tr>`;
          }).join('');
        }
        $('ae-total').textContent = list.length.toString();
        $('ae-lastUpdate').textContent = nowTime();

        tbody.querySelectorAll('[data-edit]').forEach(b => b.onclick = () => openEdit(+b.dataset.edit));
        tbody.querySelectorAll('[data-del]').forEach(b => b.onclick = () => delTurno(+b.dataset.del));
      }

      // === Combos
      async function loadCombos() {
        try {
          empleados = await fetchJSON(API_EMPLEADOS_GUARDIAS) || [];
        } catch { empleados = []; }

        try {
          estacionamientos = await fetchJSON(API_EST) || [];
        } catch { estacionamientos = []; }

        $('ae-modalGuard').innerHTML =
          `<option value="">Seleccionar guardia...</option>` +
          empleados.map(e => {
            const label = e.nombreCompleto || e.nombreUsuario || e.correo || `ID ${e.id}`;
            return `<option value="${e.id}">${label}</option>`;
          }).join('');

        $('ae-modalParking').innerHTML =
          `<option value="">Seleccionar estacionamiento...</option>` +
          estacionamientos.map(e => `<option value="${e.id}">${e.nombre}</option>`).join('');
        $('ae-filterParking').innerHTML =
          `<option value="all">Todos los estacionamientos</option>` +
          estacionamientos.map(e => `<option value="${e.id}">${e.nombre}</option>`).join('');
      }

      // === API turnos
      async function loadTurnos() {
        const resp = await fetchJSON(`${API_TURNOS}?page=${page}&size=${size}`);
        turnos = resp?.content || [];
        render(turnos);
      }

      // === CRUD
      function openNew() {
        editingId = null;
        $('ae-modalTitle').innerHTML = `
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Nueva asignación
        `;
        $('ae-modalGuard').value = ''; $('ae-modalParking').value = '';
        $('ae-modalShift').value = '08:00 - 14:00'; $('ae-modalDate').value = today();
        loadCombos();
        $('ae-modal').classList.remove('hidden'); $('ae-modal').classList.add('flex');
      }

      function openEdit(id) {
        const t = turnos.find(x => x.id === id); if (!t) return;
        editingId = id;
        $('ae-modalTitle').innerHTML = `
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Editar asignación
        `;
        $('ae-modalGuard').value = t.empleadoId;
        $('ae-modalParking').value = t.estacionamientoId;
        $('ae-modalShift').value = `${t.horaIngreso} - ${t.horaSalida}`;
        $('ae-modalDate').value = t.fechaInicio;
        $('ae-modal').classList.remove('hidden'); $('ae-modal').classList.add('flex');
      }

      function closeModal() {
        $('ae-modal').classList.add('hidden');
        $('ae-modal').classList.remove('flex');
      }

      async function saveTurno() {
        const empleadoId = parseInt($('ae-modalGuard').value, 10);
        const estacionamientoId = parseInt($('ae-modalParking').value, 10);
        const { in: horaIngreso, out: horaSalida } = splitShift($('ae-modalShift').value);
        const fechaInicio = $('ae-modalDate').value || today();

        if (!empleadoId || !estacionamientoId) {
          alert('Por favor, complete todos los campos obligatorios.');
          return;
        }

        const payload = { empleadoId, estacionamientoId, fechaInicio, fechaFin: null, horaIngreso, horaSalida };
        try {
          if (editingId) {
            await fetchJSON(`${API_TURNOS}/${editingId}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
          } else {
            await fetchJSON(API_TURNOS, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
          }
          await loadTurnos();
          closeModal();
        } catch (error) {
          alert('Error al guardar la asignación. Por favor, intente nuevamente.');
          console.error(error);
        }
      }

      async function delTurno(id) {
        if (!confirm('¿Está seguro de que desea eliminar esta asignación?')) return;
        try {
          await fetchJSON(`${API_TURNOS}/${id}`, { method: 'DELETE' });
          await loadTurnos();
        } catch (error) {
          alert('Error al eliminar la asignación.');
          console.error(error);
        }
      }

      // === Filtros (front)
      function applyFilters() {
        const q = $('ae-searchGuard').value.trim().toLowerCase();
        const p = $('ae-filterParking').value;
        const sh = $('ae-filterShift').value;

        const filtered = turnos.filter(t => {
          const byName = !q || (t.empleadoNombre || '').toLowerCase().includes(q);

          // comparar por ID (string) si existe estacionamientoId, sino caer a nombre por compatibilidad
          const estId = t.estacionamientoId !== undefined && t.estacionamientoId !== null
            ? String(t.estacionamientoId)
            : null;
          const byParking = p === 'all' || (estId ? estId === p : (t.estacionamientoNombre === p));

          const byShift = sh === 'all' || `${t.horaIngreso} - ${t.horaSalida}` === sh;

          return byName && byParking && byShift;
        });

        render(filtered);
      }


      // === Wire UI
      function wire() {
        $('ae-openModal').onclick = openNew;
        $('ae-closeModal').onclick = closeModal;
        $('ae-cancel').onclick = closeModal;
        $('ae-save').onclick = saveTurno;

        $('ae-searchGuard').oninput = applyFilters;
        $('ae-filterParking').onchange = applyFilters;
        $('ae-filterShift').onchange = applyFilters;

        document.addEventListener('keydown', e => {
          if (e.key === 'Escape') closeModal();
        });

        setInterval(() => {
          $('ae-lastUpdate').textContent = nowTime();
        }, 1000);
      }

      // === Init
      (async function init() {
        wire();
        await loadCombos();
        await loadTurnos();
      })();
    })();
  </script>
</div>